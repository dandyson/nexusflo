#!/bin/sh

# Ensure Sail is up and running
echo "Starting Sail environment..."
./vendor/bin/sail up -d

# Run tests inside Sail
echo "Running tests inside Sail..."
./vendor/bin/sail exec -T laravel.test php artisan test --parallel

# Check the result and exit if tests fail
if [ $? -ne 0 ]; then
  echo "Pre-push checks failed. Aborting push."
  exit 1
fi

echo "Pre-push checks passed. Proceeding with push."
